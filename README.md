# Digital Text Analysis thesis: God among family, friends, and business partners
This repository is currently under reconstruction - due to a serious injury from which I had to recover over the course of several months, my promotor did some of the work in constructing the final corpora from the annotated logical layout analysis files. I am currently replicating the workflow. Concretely, other than restructuring the repository into something more uniform and user-friendly, what will be added is this:

+ ~~New .hocr files representing the master corpora, consisting of reconciled Jeake and Marescoe-David annotations.~~ (done)
+ ~~Scripts for generating Jeake and Marescoe-David .json corpora.~~ (done)
+ Analysis of Tesseract's ocr-output quality.

## Objective
A case study on how references to the divine were used in the correspondence of English merchants from the seventeenth century, the thesis was embedded in the research project [Back to the Future: Future expectations in late medieval and early modern Europe, c.1400-c.1830](https://www.uantwerpen.be/en/projects/back-to-the-future/) conducted at the University of Antwerp. The temporal evolution of the manner in which the 'divine appeal', an instance in which the correspondent calls for divine assistance in their daily actions, was invoked in their correspondence could provide insight into one possible way secularisation shaped future thinking.

_God among family, friends, and business partners_ used two corpora of letter collections, each from a different merchant family: one was the Jeake family of Rye, the other the Marescoe family, centered around Charles Marescoe, his widow Leonore Marescoe, and her second husband Jacob David. In order to analyse the corpora for instances of divine appeals, the letter collections were scanned and digitised using [Tesseract's OCR engine](https://github.com/tesseract-ocr/tesseract). The results were then processed into the necessary datasets used for querying the corpora for instances of divine appeals.

## Structure
The repository is structured as follows:

+ **corpus:** map containing the master .hocr files used to create the digital corpora, .json files representing the digitised corpora, and a Jupyter notebook _explore_corpus.ipynb_ in which the .json files are converted to .csv metadata sets, and prints examples of different letter segments (keys).
+ **datasets:** the final datasets, queried on instances of the divine, generated by the _query_corpus_ scripts. Contains both the raw .txt versions of the datasets, the bare .xlsx versions, the annotated versions, and the final dataset, with analytics ran on the divine appeal queries.
+ **images:** images of plots drawn in Excel from the queried data.
+ **logical_layout_analysis:** contains datasets in the map _data_ for logical layout analysis (i.e. annotating every line of the corpora to identify their letter segments). Included are also to Jupyter notebooks, one to explore the .xhtml structure of the .hocr files, the second to expand the base lla datasets with additional line distance variables to make annotation easier.
+ **metadata:** metadata of the digitised corpora, enriched with variables such as the sender and addressee's birth years, genders, the nature of their connection, and the gap between their ages.
+ **ocr_output:** Tesseract's .hocr output of the scanned image files.
+ **scripts:** various scripts used to process the .hocr output files into the final datasets.
+ **statistics:** statistics on the annotated data run in R.

## Scripts
A brief overview of the scripts used to process the data. This overview is presented in order of execution during the workflow:

+ **tesseract_script:** a shell file (for Mac) and a batch file (for Windows) to run the OCR engine on the input image files.
+ **utils:** helper functions to clean and finalise the corpora. Contains functions to normalise punctuation, correcting common spelling errors resulting from erronous OCR processing (mostly applicable to the Marescoe-David data, which had a relatively fine print and glossy paper), and to count the number of words of the individual letters.
+ **map_filenames:** generates an Excel file that is used to map the page numbers to their respective scanned .hocr files (filenames). The page numbers form an important part of the metadata to be used on future tasks, since they help as sanity checks when needing to refer back to the original input (i.e. the printed books).
+ **build_lla_dataset:** using the data from the .hocr files and the dataset containing the page numbers mapped to their respective filenames, this script builds the base dataset for logical layout analysis.
+ **reconcile_hocr_csv:** reconciles the data from the annotated lla datasets with the .hocr output files, and saves them as the master files in the _corpus_ map.
+ **reorder_xml:** written specifically for the Marescoe-David dataset. Given the layout structure of the printed letters, the OCR engine had trouble determining the location of several letter elements, in particular the language tags and letter identifiers. Consequentially, the OCR usually assigned the coordinates for all of the tags and identifiers to the top portion of the page, resulting in information about letter elements merging into different letters in the digitised corpora. Using an extra column to identify and correct the line identifiers of these problematic lines, the script reorders the .hocr data in such a way that the letter elements are assigned to the correct letters.
+ **corpus:** the corpus scripts build the digitised corpora based on the reconciled .hocr master files as a list of dictionaries, in which each key represents metadata for every letter, and save it as .json files. The result is cleaned and enriched by the functions from the _utils_ script. Due to the Jeake and Marescoe-David collections each containing different letter elements/metadata, two scripts were written, each one adapted to work specifically on a particular corpus.
+ **enrich_metadata:** after manually adding metadata such as the correspondent's birth years, this script further enriches the metadata by calculating how old the correspondents were while writing each letter, what the age gap between the sender and addressee was, etc.
+ **query_corpus:** generates the final dataset by taking the contents of the .json corpora and the enriched metadata, and querying the letter contents for instances referring to God or the divine. Due to the Jeake and Marescoe-David collections having a slightly different column layout resulting from differences in metadata, two scripts were written, each one adapted to work specifically on a particular corpus.
+ **map_query:** generates an Excel file that reconciles the number of divine appeal hits within each corpus (drawn from the final datasets) to the total number of letters in the corpus (drawn from the metadata datasets, as the final datasets exclude any letters omitting referrals to the divine), based on their letter identifier/serial number. The results can be used to calculate normalised frequencies of divine appeals in their respective corpora.
